DROP DATABASE IF EXISTS QLDA;
CREATE DATABASE QLDA;
USE QLDA;

CREATE TABLE PHONGBAN (
TENPHG NVARCHAR(15),
PHG INT,
TRPHG CHAR(9),
NG_NHANCHUC DATE ,
CONSTRAINT PK_PHONGBAN PRIMARY KEY (PHG));

CREATE TABLE NHANVIEN (
HONV NVARCHAR(15) NOT NULL,
TENLOT NVARCHAR(15) NOT NULL,
TENNV NVARCHAR(15) NOT NULL,
MANV CHAR(9) NOT NULL,
NGSINH DATE,
DCHI NVARCHAR(30),
PHAI NVARCHAR(3),
LUONG FLOAT,
MA_NQL CHAR(9),
PHG INT,
CONSTRAINT PK_NHANVIEN PRIMARY KEY (MANV),
CONSTRAINT CK_PHAI CHECK (PHAI IN ('M','F')),
CONSTRAINT FK_NV_MQL FOREIGN KEY (MA_NQL) REFERENCES NHANVIEN(MANV),
CONSTRAINT FK_NV_PB FOREIGN KEY (PHG) REFERENCES PHONGBAN(PHG));

CREATE TABLE DEAN (
TENDA NVARCHAR(15),
MADA INT,
DDIEM_DA NVARCHAR(15),
PHONG INT,
CONSTRAINT PK_DEAN PRIMARY KEY (MADA),
CONSTRAINT FK_DEAN_PHG FOREIGN KEY (PHONG) REFERENCES PHONGBAN(PHG));

CREATE TABLE DIADIEM_PHG (
PHG INT,
DIADIEM NVARCHAR(15),
CONSTRAINT PK_DIADIEM_PHG PRIMARY KEY (PHG,DIADIEM),
CONSTRAINT FK_DD_PHG FOREIGN KEY (PHG) REFERENCES PHONGBAN(PHG));

CREATE TABLE CONGVIEC (
MADA INT,
STT INT,
TEN_CONG_VIEC NVARCHAR(50),
CONSTRAINT PK_CONGVIEC PRIMARY KEY (MADA,STT),
CONSTRAINT FK_CV_MADA FOREIGN KEY (MADA) REFERENCES DEAN(MADA));

CREATE TABLE PHANCONG (
MANV CHAR(9) NOT NULL,
MADA INT,
STT INT,
THOIGIAN FLOAT,
CONSTRAINT PK_PHANCONG PRIMARY KEY (MANV,MADA,STT),
CONSTRAINT FK_PC_NV FOREIGN KEY (MANV) REFERENCES NHANVIEN(MANV),
CONSTRAINT FK_PC_STT FOREIGN KEY (MADA,STT) REFERENCES CONGVIEC(MADA,STT));

CREATE TABLE THANNHAN (
MANV CHAR(9) NOT NULL,
TENTN NVARCHAR(15),
PHAI CHAR(3),
NGSINH DATE,
QUANHE NVARCHAR(15),
CONSTRAINT PK_THANNHAN PRIMARY KEY (MANV,TENTN),
CONSTRAINT FK_NV FOREIGN KEY (MANV) REFERENCES NHANVIEN(MANV));

ALTER TABLE PHONGBAN
	ADD CONSTRAINT FK_PB_NV FOREIGN KEY (TRPHG) REFERENCES NHANVIEN(MANV);

INSERT PHONGBAN(TENPHG, PHG,NG_NHANCHUC)
VALUES
	(N'Nghiên cứu',5, '1978-05-22'),
	(N'Điều hành',4, '1985-01-01'),
	(N'Quản lý',1, '1971-06-19');
    
SET FOREIGN_KEY_CHECKS=0;
INSERT NHANVIEN (HONV, TENLOT, TENNV, MANV, NGSINH, DCHI, PHAI, LUONG, MA_NQL, PHG)
VALUES 
	(N'Đinh',N'Bá',N'Tiến','009','1960-11-02',N'119 Cổng Quỳnh, Tp HCM','M',30000,'005',5),
	(N'Nguyễn',N'Thanh',N'Tùng','005','1962-02-08',N'222 Nguyễn Văn Cừ, Tp HCM','M',40000,'006',5),
	(N'Bùi',N'Ngọc',N'Hằng','007','1954-11-03',N'332 Nguyễn Thái Học, Tp HCM','M',25000,'001',4),
	(N'Lê',N'Quỳnh',N'Như','001','1967-01-02',N'291 Hồ Văn Huê, Tp HCM', N'F',43000,'006',4),
	(N'Nguyễn',N'Mạnh',N'Hùng','004','1967-04-03',N'95 Bà Rịa, Vũng Tàu','M',38000,'005',5),
	(N'Trần',N'Thanh',N'Tâm','003','1957-04-05',N'34 Mai Thị Lự,  Tp HCM','M',25000,'005',5),
	(N'Trần',N'Hồng',N'Quang','008','1967-01-09',N'80 Lê Hồng Phong, Tp HCM','M',25000,'001',4),
	(N'Phạm',N'Văn',N'Vinh','006','1965-01-01',N'45 Trưng Vương, Hà Nội',N'F',55000,NULL,1);
SET FOREIGN_KEY_CHECKS=1;

UPDATE PHONGBAN
SET TRPHG='005' WHERE PHG =5;

UPDATE PHONGBAN
SET TRPHG='008' WHERE PHG=4;

UPDATE PHONGBAN
SET TRPHG='006' WHERE PHG=1;

INSERT DIADIEM_PHG(PHG,DIADIEM)
VALUES 
	(1,N'TP HCM'),
	(4,N'Hà Nội'),
	(5,N'VŨNG TÀU'),
	(5,N'NHA TRANG'),
	(5,N'TP HCM');
    
INSERT THANNHAN(MANV, TENTN,PHAI,NGSINH,QUANHE)
VALUES
	('005',N'Trinh',N'F','1976-04-05', N'Con gái'),
	('005',N'Khang',N'M','1973-10-25', N'Con trai'),
	('005',N'Phương',N'F','1948-05-03', N'Vợ chồng'),
	('001',N'Minh',N'M','1932-02-29', N'Vợ chồng'),
	('009',N'Tiến',N'M','1978-01-01', N'Con trai'),
	('009',N'Châu',N'F','1978-12-30', N'Con gái'),
	('009',N'Phương',N'F','1957-05-05', N'Vợ chồng');

INSERT DEAN
VALUES 
	(N'Sản phẩm X',1,N'Vũng Tàu',5),
	(N'Sản phẩm Y',2,N'Nha Trang',5),
	(N'Sản phẩm Z',3,N'TP HCM',5),
	(N'Tin học hóa',10,N'Hà Nội',4),
	(N'Cáp quang',20,N'TP HCM',1),
	(N'Đào tạo',30,N'Hà Nội',4);

INSERT CONGVIEC
VALUES 
	(1,1,N'Thiết kế sản phẩm X'),
	(1,2,N'Thử nghiệm sản phẩm X'),
	(2,1,N'Sản xuất sản phẩm Y'),
	(2,2,N'Quảng cáo sản phẩm Y'),
	(3,1,N'Khuyến mãi sản phẩm Z'),
	(10,1,N'Tin học hóa phòng nhân sự'),
	(10,2,N'Tin học hóa phòng kinh doanh'),
	(20,1,N'Lắp đặt cáp quang'),
	(30,1,N'Đào tạo nhân viên Marketing'),
	(30,2,N'Đào tạo chuyên viên thiết kế');

INSERT PHANCONG
VALUES ('009',1,1,32),('009',2,2,8),('004',3,1,40),
       ('003',1,2,20),('003',2,1,20),('008',10,1,35),
	   ('008',30,2,5),('001',30,1,20),('001',20,1,15),
	   ('006',20,1,30),('005',3,1,10),('005',10,2,10),
	   ('005',20,1,10),('007',30,2,30),('007',10,2,10);